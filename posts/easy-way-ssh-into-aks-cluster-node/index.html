<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Easy way to SSH into Azure Kubernetes Service cluster node VMs | Yoichi Kawasaki</title>
<meta name=keywords content="ssh,azure,kubernetes,azure-kubernetes-services,kubectl-plugin"><meta name=description content="This is an article on how you can SSH into Azure Kubernetes Service (AKS) cluster node VMs using kubectl-plugin-ssh-jump.
Motivation I wanted to SSH into Azure Kubernetes Service (AKS) cluster node VMs, then looking up azure docs I found a relevant page - Connect with SSH to Azure Kubernetes Service (AKS) cluster nodes for maintenance or troubleshooting. But when I first saw this procedure, I thought this was very troublesome. Lazy person like me couldn&rsquo;t accept going thourgh all the steps just to SSH into AKS cluster nodes VMs."><meta name=author content="Yoichi Kawasaki"><link rel=canonical href=https://unofficialism.info/posts/easy-way-ssh-into-aks-cluster-node/><link crossorigin=anonymous href=https://unofficialism.info/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=https://unofficialism.info/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://unofficialism.info/profile.jpg><link rel=icon type=image/png sizes=16x16 href=https://unofficialism.info/profile.jpg><link rel=icon type=image/png sizes=32x32 href=https://unofficialism.info/profile.jpg><link rel=apple-touch-icon href=https://unofficialism.info/profile.jpg><link rel=mask-icon href=https://unofficialism.info/profile.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Easy way to SSH into Azure Kubernetes Service cluster node VMs | Yoichi Kawasaki"><meta property="og:description" content="This is an article on how you can SSH into Azure Kubernetes Service (AKS) cluster node VMs using kubectl-plugin-ssh-jump.
Motivation I wanted to SSH into Azure Kubernetes Service (AKS) cluster node VMs, then looking up azure docs I found a relevant page - Connect with SSH to Azure Kubernetes Service (AKS) cluster nodes for maintenance or troubleshooting. But when I first saw this procedure, I thought this was very troublesome. Lazy person like me couldn&rsquo;t accept going thourgh all the steps just to SSH into AKS cluster nodes VMs."><meta property="og:type" content="article"><meta property="og:url" content="https://unofficialism.info/posts/easy-way-ssh-into-aks-cluster-node/"><meta property="og:image" content="https://unofficialism.info/assets/20190212-arch-ssh-jumphost.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-12T08:32:40+00:00"><meta property="article:modified_time" content="2019-02-12T08:32:40+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://unofficialism.info/assets/20190212-arch-ssh-jumphost.png"><meta name=twitter:title content="Easy way to SSH into Azure Kubernetes Service cluster node VMs | Yoichi Kawasaki"><meta name=twitter:description content="This is an article on how you can SSH into Azure Kubernetes Service (AKS) cluster node VMs using kubectl-plugin-ssh-jump.
Motivation I wanted to SSH into Azure Kubernetes Service (AKS) cluster node VMs, then looking up azure docs I found a relevant page - Connect with SSH to Azure Kubernetes Service (AKS) cluster nodes for maintenance or troubleshooting. But when I first saw this procedure, I thought this was very troublesome. Lazy person like me couldn&rsquo;t accept going thourgh all the steps just to SSH into AKS cluster nodes VMs."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://unofficialism.info/posts/"},{"@type":"ListItem","position":3,"name":"Easy way to SSH into Azure Kubernetes Service cluster node VMs","item":"https://unofficialism.info/posts/easy-way-ssh-into-aks-cluster-node/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Easy way to SSH into Azure Kubernetes Service cluster node VMs","name":"Easy way to SSH into Azure Kubernetes Service cluster node VMs","description":"This is an article on how you can SSH into Azure Kubernetes Service (AKS) cluster node VMs using kubectl-plugin-ssh-jump.\nMotivation I wanted to SSH into Azure Kubernetes Service (AKS) cluster node VMs, then looking up azure docs I found a relevant page - Connect with SSH to Azure Kubernetes Service (AKS) cluster nodes for maintenance or troubleshooting. But when I first saw this procedure, I thought this was very troublesome. Lazy person like me couldn\u0026rsquo;t accept going thourgh all the steps just to SSH into AKS cluster nodes VMs.","keywords":["ssh","azure","kubernetes","azure-kubernetes-services","kubectl-plugin"],"articleBody":"This is an article on how you can SSH into Azure Kubernetes Service (AKS) cluster node VMs using kubectl-plugin-ssh-jump.\nMotivation I wanted to SSH into Azure Kubernetes Service (AKS) cluster node VMs, then looking up azure docs I found a relevant page - Connect with SSH to Azure Kubernetes Service (AKS) cluster nodes for maintenance or troubleshooting. But when I first saw this procedure, I thought this was very troublesome. Lazy person like me couldn’t accept going thourgh all the steps just to SSH into AKS cluster nodes VMs. This is why I decided to create kubectl-plugin-ssh-jump, a kubectl plugin to SSH into Kubernetes nodes using a SSH jump host Pod.\nAKS node access control and SSH access strategy By default, AKS nodes are not exposed to the internet, and they are completely isolated to their own virtual network. This is why I took a strategy to go through a jump host Pod to connect to the Kubernetes nodes. I believe this is pretty a general strategy in dealing with firewalling, access privileges, etc.\nRegarding SSH key with which you access the nodes via SSH, you need to use the SSH key that you chosen in creating your AKS cluster. Or in the case that you lose the key, you can update SSH Key by using az command like this (See this for more detail):\naz vm user update \\ --resource-group myResourceGroup \\ --name myVM \\ --username azureuser \\ --ssh-key-value ~/.ssh/id_rsa.pub As an additional security enhancement, you can configure Access Control(IAM) on the AKS cluster to set permissions on the nodes on who can access them. Please see What is role-based access control (RBAC)? for the detail on RBAC.\nSSH into AKS node VMs using kubectl-plugin-ssh-jump Pre-requistes This plugin needs the following programs:\nssh(1) ssh-agent(1) Installation Install through krew This is a way to install kubectl-ssh-jump through krew. After installing krew by following this, you can install kubectl-ssh-jump like this:\n$ kubectl krew install ssh-jump Expected output would be like this:\nUpdated the local copy of plugin index. Installing plugin: ssh-jump CAVEATS: \\ | This plugin needs the following programs: | * ssh(1) | * ssh-agent(1) | | Please follow the documentation: https://github.com/yokawasa/kubectl-plugin-ssh-jump / Installed plugin: ssh-jump Once it’s installed, run:\n$ kubectl plugin list The following kubectl-compatible plugins are available: /Users/yoichika/.krew/bin/kubectl-krew /Users/yoichika/.krew/bin/kubectl-ssh_jump $ kubectl ssh-jump Manual Installation Install the plugin by copying the script in the $PATH of your shell.\n# Get source $ git clone https://github.com/yokawasa/kubectl-plugin-ssh-jump.git $ cd kubectl-plugin-ssh-jump $ chmod +x kubectl-ssh-jump # Add kubeclt-ssh-jump to the install path. $ sudo cp -p kubectl-ssh-jump /usr/local/bin Once in the $PATH, run:\n$ kubectl plugin list The following kubectl-compatible plugins are available: /usr/local/bin/kubectl-ssh-jump $ kubectl ssh-jump How to use Usage Usage: kubectl ssh-jump [options] Options: Destination node IP -u, --user SSH User name -i, --identity Identity key file -p, --pubkey Public key file --skip-agent Skip automatically starting SSH agent and adding SSH Identity key into the agent before SSH login (=\u003e You need to manage SSH agent by yourself) --cleanup-agent Clearning up SSH agent at the end The agent is NOT cleaned up in case that --skip-agent option is given --cleanup-jump Clearning up sshjump pod at the end Default: Skip cleaning up sshjump pod -h, --help Show this message Option parameters Cache username, identity, pubkey options are cached, therefore you can omit these options afterward. The options are stored in a file named $HOME/.kube/kubectlssh/options\n$ cat $HOME/.kube/kubectlssh/options sshuser=azureuser identity=/Users/yokawasa/.ssh/id_rsa_k8s pubkey=/Users/yokawasa/.ssh/id_rsa_k8s.pub SSH Agent (ssh-agent) The plugin automatically check if there are any ssh-agents started running by the plugin, and starts ssh-agentif it doesn’t find any ssh-agent running and adds SSH Identity key into the agent before SSH login. If the command find that ssh-agent is already running, it doesn’t start a new agent, and re-use the agent. Add --cleanup-agent option if you want to kill the created agent at the end of command.\nIn addtion, add --skip-agent option if you want to skip automatic starting ssh-agent. This is actually a case where you already have ssh-agent managed or you want to manually start the agent.\nExamples Show all node list. Simply executing kubectl ssh-jump gives you the list of destination nodes as well as command usage\n$ kubectl ssh-jump Usage: kubectl ssh-jump [options] Options: Destination node IP -u, --user SSH User name -i, --identity Identity key file -p, --pubkey Public key file --skip-agent Skip automatically starting SSH agent and adding SSH Identity key into the agent before SSH login (=\u003e You need to manage SSH agent by yourself) --cleanup-agent Clearning up SSH agent at the end The agent is NOT cleaned up in case that --skip-agent option is given --cleanup-jump Clearning up sshjump pod at the end Default: Skip cleaning up sshjump pod -h, --help Show this message Example: .... List of destination node... Hostname aks-nodepool1-18558189-0 aks-nodepool1-18558189-1 aks-nodepool1-18558189-2 Then, SSH into a node aks-nodepool1-18558189-0 with options like:\nusernaem: azureuser identity:~/.ssh/id_rsa_k8s pubkey:~/.ssh/id_rsa_k8s.pub) $ kubectl ssh-jump aks-nodepool1-18558189-0 \\ -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub As explained in usage secion, username, identity, pubkey options are cached, therefore you can omit these options afterward.\n$ kubectl ssh-jump aks-nodepool1-18558189-0 You can pass the commands to run in the destination node like this (Suppose that username, identity, pubkey options are cached):\necho \"uname -a\" | kubectl ssh-jump aks-nodepool1-18558189-0 (Output) Linux aks-nodepool1-18558189-0 4.15.0-1035-azure #36~16.04.1-Ubuntu SMP Fri Nov 30 15:25:49 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux You can clean up sshjump pod at the end of the command with --cleanup-jump option, otherwise, the sshjump pod stay running by default.\n$ kubectl ssh-jump aks-nodepool1-18558189-0 \\ -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub \\ --cleanup-jump You can clean up ssh-agent at the end of the command with --cleanup-agent option, otherwise, the ssh-agent process stay running once it’s started.\n$ kubectl ssh-jump aks-nodepool1-18558189-0 \\ -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub \\ --cleanup-agent You can skip starting ssh-agent by giving --skip-agent. This is actually a case where you already have ssh-agent managed. Or you can start new ssh-agent and add an identity key to the ssh-agent like this:\n# Start ssh-agent manually $ eval `ssh-agent` # Add an arbitrary private key, give the path of the key file as an argument to ssh-add $ ssh-add ~/.ssh/id_rsa_k8s # Then, run the plugin with --skip-agent $ kubectl ssh-jump aks-nodepool1-18558189-0 \\ -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub \\ --skip-agent # At the end, run this if you want to kill the current agent $ ssh-agent -k ","wordCount":"1070","inLanguage":"en","datePublished":"2019-02-12T08:32:40Z","dateModified":"2019-02-12T08:32:40Z","author":{"@type":"Person","name":"Yoichi Kawasaki"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://unofficialism.info/posts/easy-way-ssh-into-aks-cluster-node/"},"publisher":{"@type":"Organization","name":"Yoichi Kawasaki","logo":{"@type":"ImageObject","url":"https://unofficialism.info/profile.jpg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://unofficialism.info accesskey=h title="Yoichi Kawasaki (Alt + H)">Yoichi Kawasaki</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://unofficialism.info/about title=about><span>about</span></a></li><li><a href=https://unofficialism.info/posts title=posts><span>posts</span></a></li><li><a href=https://unofficialism.info/works title=works><span>works</span></a></li><li><a href=https://unofficialism.info/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://unofficialism.info/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://unofficialism.info>Home</a>&nbsp;»&nbsp;<a href=https://unofficialism.info/posts/>Posts</a></div><h1 class=post-title>Easy way to SSH into Azure Kubernetes Service cluster node VMs</h1><div class=post-meta>&lt;span title='2019-02-12 00:00:00 +0000 UTC'>February 12, 2019&lt;/span>&amp;nbsp;·&amp;nbsp;6 min&amp;nbsp;·&amp;nbsp;Yoichi Kawasaki&nbsp;|&nbsp;<a href=https://github.com/yokawasa/yokawasa.github.io/tree/master/content/posts/2019-02-12-easy-way-ssh-into-aks-cluster-node.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#motivation aria-label=Motivation>Motivation</a></li><li><a href=#aks-node-access-control-and-ssh-access-strategy aria-label="AKS node access control and SSH access strategy">AKS node access control and SSH access strategy</a></li><li><a href=#ssh-into-aks-node-vms-using-kubectl-plugin-ssh-jump aria-label="SSH into AKS node VMs using kubectl-plugin-ssh-jump">SSH into AKS node VMs using kubectl-plugin-ssh-jump</a><ul><li><a href=#pre-requistes aria-label=Pre-requistes>Pre-requistes</a></li><li><a href=#installation aria-label=Installation>Installation</a><ul><li><a href=#install-through-krew aria-label="Install through krew">Install through krew</a></li><li><a href=#manual-installation aria-label="Manual Installation">Manual Installation</a></li></ul></li><li><a href=#how-to-use aria-label="How to use">How to use</a><ul><li><a href=#usage aria-label=Usage>Usage</a><ul><li><a href=#option-parameters-cache aria-label="Option parameters Cache">Option parameters Cache</a></li><li><a href=#ssh-agent-ssh-agent aria-label="SSH Agent (ssh-agent)">SSH Agent (ssh-agent)</a></li></ul></li><li><a href=#examples aria-label=Examples>Examples</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p>This is an article on how you can SSH into Azure Kubernetes Service (AKS) cluster node VMs using <a href=https://github.com/yokawasa/kubectl-plugin-ssh-jump>kubectl-plugin-ssh-jump</a>.</p><h2 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h2><p>I wanted to SSH into Azure Kubernetes Service (AKS) cluster node VMs, then looking up azure docs I found a relevant page - <a href=https://docs.microsoft.com/en-us/azure/aks/ssh>Connect with SSH to Azure Kubernetes Service (AKS) cluster nodes for maintenance or troubleshooting</a>. But when I first saw this procedure, I thought this was very troublesome. Lazy person like me couldn&rsquo;t accept going thourgh all the steps just to SSH into AKS cluster nodes VMs. This is why I decided to create <a href=https://github.com/yokawasa/kubectl-plugin-ssh-jump>kubectl-plugin-ssh-jump</a>, a kubectl plugin to SSH into Kubernetes nodes using a SSH jump host Pod.</p><h2 id=aks-node-access-control-and-ssh-access-strategy>AKS node access control and SSH access strategy<a hidden class=anchor aria-hidden=true href=#aks-node-access-control-and-ssh-access-strategy>#</a></h2><p>By default, AKS nodes are not exposed to the internet, and they are completely isolated to their own virtual network. This is why I took a strategy to go through a jump host Pod to connect to the Kubernetes nodes. I believe this is pretty a general strategy in dealing with firewalling, access privileges, etc.</p><p><img loading=lazy src=https://unofficialism.info/assets/20190212-arch-ssh-jumphost.png alt></p><p>Regarding SSH key with which you access the nodes via SSH, you need to use the SSH key that you chosen in creating your AKS cluster. Or in the case that you lose the key, you can update SSH Key by using az command like this (See <a href=https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/vmaccess#update-ssh-key>this</a> for more detail):</p><pre tabindex=0><code>az vm user update \
  --resource-group myResourceGroup \
  --name myVM \
  --username azureuser \
  --ssh-key-value ~/.ssh/id_rsa.pub
</code></pre><p>As an additional security enhancement, you can configure Access Control(IAM) on the AKS cluster to set permissions on the nodes on who can access them. Please see <a href=https://docs.microsoft.com/en-us/azure/role-based-access-control/overview>What is role-based access control (RBAC)?</a> for the detail on RBAC.</p><h2 id=ssh-into-aks-node-vms-using-kubectl-plugin-ssh-jump>SSH into AKS node VMs using kubectl-plugin-ssh-jump<a hidden class=anchor aria-hidden=true href=#ssh-into-aks-node-vms-using-kubectl-plugin-ssh-jump>#</a></h2><h3 id=pre-requistes>Pre-requistes<a hidden class=anchor aria-hidden=true href=#pre-requistes>#</a></h3><p>This plugin needs the following programs:</p><ul><li>ssh(1)</li><li>ssh-agent(1)</li></ul><h3 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h3><h4 id=install-through-krew>Install through krew<a hidden class=anchor aria-hidden=true href=#install-through-krew>#</a></h4><p>This is a way to install kubectl-ssh-jump through <a href=https://github.com/GoogleContainerTools/krew>krew</a>. After installing krew by following <a href=https://github.com/GoogleContainerTools/krew#installation>this</a>, you can install kubectl-ssh-jump like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl krew install ssh-jump
</span></span></code></pre></div><p>Expected output would be like this:</p><pre tabindex=0><code>Updated the local copy of plugin index.
Installing plugin: ssh-jump
CAVEATS:
\
 |  This plugin needs the following programs:
 |  * ssh(1)
 |  * ssh-agent(1)
 |
 |  Please follow the documentation: https://github.com/yokawasa/kubectl-plugin-ssh-jump
/
Installed plugin: ssh-jump
</code></pre><p>Once it&rsquo;s installed, run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl plugin list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The following kubectl-compatible plugins are available:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/Users/yoichika/.krew/bin/kubectl-krew
</span></span><span style=display:flex><span>/Users/yoichika/.krew/bin/kubectl-ssh_jump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl ssh-jump
</span></span></code></pre></div><h4 id=manual-installation>Manual Installation<a hidden class=anchor aria-hidden=true href=#manual-installation>#</a></h4><p>Install the plugin by copying the script in the $PATH of your shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Get source</span>
</span></span><span style=display:flex><span>$ git clone https://github.com/yokawasa/kubectl-plugin-ssh-jump.git
</span></span><span style=display:flex><span>$ cd kubectl-plugin-ssh-jump
</span></span><span style=display:flex><span>$ chmod +x kubectl-ssh-jump
</span></span><span style=display:flex><span><span style=color:#75715e># Add kubeclt-ssh-jump to the install path.</span>
</span></span><span style=display:flex><span>$ sudo cp -p kubectl-ssh-jump /usr/local/bin
</span></span></code></pre></div><p>Once in the $PATH, run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl plugin list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The following kubectl-compatible plugins are available:
</span></span><span style=display:flex><span>/usr/local/bin/kubectl-ssh-jump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl ssh-jump
</span></span></code></pre></div><h3 id=how-to-use>How to use<a hidden class=anchor aria-hidden=true href=#how-to-use>#</a></h3><h4 id=usage>Usage<a hidden class=anchor aria-hidden=true href=#usage>#</a></h4><pre tabindex=0><code class=language-TXT data-lang=TXT>Usage:
  kubectl ssh-jump &lt;dest_node&gt; [options]

Options:
  &lt;dest_node&gt;                     Destination node IP
  -u, --user &lt;sshuser&gt;            SSH User name
  -i, --identity &lt;identity_file&gt;  Identity key file
  -p, --pubkey &lt;pub_key_file&gt;     Public key file
  --skip-agent                    Skip automatically starting SSH agent and adding
                                  SSH Identity key into the agent before SSH login
                                  (=&gt; You need to manage SSH agent by yourself)
  --cleanup-agent                 Clearning up SSH agent at the end
                                  The agent is NOT cleaned up in case that 
                                  --skip-agent option is given
  --cleanup-jump                  Clearning up sshjump pod at the end
                                  Default: Skip cleaning up sshjump pod
  -h, --help                      Show this message
</code></pre><h5 id=option-parameters-cache>Option parameters Cache<a hidden class=anchor aria-hidden=true href=#option-parameters-cache>#</a></h5><p><code>username</code>, <code>identity</code>, <code>pubkey</code> options are cached, therefore you can omit these options afterward. The options are stored in a file named <code>$HOME/.kube/kubectlssh/options</code></p><pre tabindex=0><code>$ cat $HOME/.kube/kubectlssh/options
sshuser=azureuser
identity=/Users/yokawasa/.ssh/id_rsa_k8s
pubkey=/Users/yokawasa/.ssh/id_rsa_k8s.pub
</code></pre><h5 id=ssh-agent-ssh-agent>SSH Agent (ssh-agent)<a hidden class=anchor aria-hidden=true href=#ssh-agent-ssh-agent>#</a></h5><p>The plugin automatically check if there are any <code>ssh-agents</code> started running by the plugin, and starts <code>ssh-agent</code>if it doesn&rsquo;t find any <code>ssh-agent</code> running and adds SSH Identity key into the agent before SSH login. If the command find that ssh-agent is already running, it doesn&rsquo;t start a new agent, and re-use the agent.
Add <code>--cleanup-agent</code> option if you want to kill the created agent at the end of command.</p><p>In addtion, add <code>--skip-agent</code> option if you want to skip automatic starting <code>ssh-agent</code>. This is actually a case where you already have ssh-agent managed or you want to manually start the agent.</p><h4 id=examples>Examples<a hidden class=anchor aria-hidden=true href=#examples>#</a></h4><p>Show all node list. Simply executing <code>kubectl ssh-jump</code> gives you the list of destination nodes as well as command usage</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl ssh-jump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>  kubectl ssh-jump &lt;dest_node&gt; <span style=color:#f92672>[</span>options<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Options:
</span></span><span style=display:flex><span>  &lt;dest_node&gt;                     Destination node IP
</span></span><span style=display:flex><span>  -u, --user &lt;sshuser&gt;            SSH User name
</span></span><span style=display:flex><span>  -i, --identity &lt;identity_file&gt;  Identity key file
</span></span><span style=display:flex><span>  -p, --pubkey &lt;pub_key_file&gt;     Public key file
</span></span><span style=display:flex><span>  --skip-agent                    Skip automatically starting SSH agent and adding
</span></span><span style=display:flex><span>                                  SSH Identity key into the agent before SSH login
</span></span><span style=display:flex><span>                                  <span style=color:#f92672>(=</span>&gt; You need to manage SSH agent by yourself<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  --cleanup-agent                 Clearning up SSH agent at the end
</span></span><span style=display:flex><span>                                  The agent is NOT cleaned up in <span style=color:#66d9ef>case</span> that
</span></span><span style=display:flex><span>                                  --skip-agent option is given
</span></span><span style=display:flex><span>  --cleanup-jump                  Clearning up sshjump pod at the end
</span></span><span style=display:flex><span>                                  Default: Skip cleaning up sshjump pod
</span></span><span style=display:flex><span>  -h, --help                      Show this message
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Example:
</span></span><span style=display:flex><span>   ....
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>List of destination node...
</span></span><span style=display:flex><span>Hostname
</span></span><span style=display:flex><span>aks-nodepool1-18558189-0
</span></span><span style=display:flex><span>aks-nodepool1-18558189-1
</span></span><span style=display:flex><span>aks-nodepool1-18558189-2
</span></span></code></pre></div><p>Then, SSH into a node <code>aks-nodepool1-18558189-0</code> with options like:</p><ul><li>usernaem: <code>azureuser</code></li><li>identity:<code>~/.ssh/id_rsa_k8s</code></li><li>pubkey:<code>~/.ssh/id_rsa_k8s.pub</code>)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl ssh-jump aks-nodepool1-18558189-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub
</span></span></code></pre></div><p>As explained in usage secion, <code>username</code>, <code>identity</code>, <code>pubkey</code> options are cached, therefore you can omit these options afterward.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl ssh-jump aks-nodepool1-18558189-0
</span></span></code></pre></div><p>You can pass the commands to run in the destination node like this (Suppose that <code>username</code>, <code>identity</code>, <code>pubkey</code> options are cached):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo <span style=color:#e6db74>&#34;uname -a&#34;</span> | kubectl ssh-jump aks-nodepool1-18558189-0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>Output<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Linux aks-nodepool1-18558189-0 4.15.0-1035-azure <span style=color:#75715e>#36~16.04.1-Ubuntu SMP Fri Nov 30 15:25:49 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span></code></pre></div><p>You can clean up sshjump pod at the end of the command with <code>--cleanup-jump</code> option, otherwise, the sshjump pod stay running by default.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl ssh-jump aks-nodepool1-18558189-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --cleanup-jump
</span></span></code></pre></div><p>You can clean up ssh-agent at the end of the command with <code>--cleanup-agent</code> option, otherwise, the ssh-agent process stay running once it&rsquo;s started.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl ssh-jump aks-nodepool1-18558189-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --cleanup-agent
</span></span></code></pre></div><p>You can skip starting <code>ssh-agent</code> by giving <code>--skip-agent</code>. This is actually a case where you already have ssh-agent managed. Or you can start new ssh-agent and add an identity key to the ssh-agent like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Start ssh-agent manually</span>
</span></span><span style=display:flex><span>$ eval <span style=color:#e6db74>`</span>ssh-agent<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Add an arbitrary private key, give the path of the key file as an argument to ssh-add</span>
</span></span><span style=display:flex><span>$ ssh-add ~/.ssh/id_rsa_k8s
</span></span><span style=display:flex><span><span style=color:#75715e># Then, run the plugin with --skip-agent</span>
</span></span><span style=display:flex><span>$ kubectl ssh-jump aks-nodepool1-18558189-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -u azureuser -i ~/.ssh/id_rsa_k8s -p ~/.ssh/id_rsa_k8s.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --skip-agent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># At the end, run this if you want to kill the current agent</span>
</span></span><span style=display:flex><span>$ ssh-agent -k
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://unofficialism.info/tags/ssh/>ssh</a></li><li><a href=https://unofficialism.info/tags/azure/>azure</a></li><li><a href=https://unofficialism.info/tags/kubernetes/>Kubernetes</a></li><li><a href=https://unofficialism.info/tags/azure-kubernetes-services/>azure-kubernetes-services</a></li><li><a href=https://unofficialism.info/tags/kubectl-plugin/>kubectl-plugin</a></li></ul><nav class=paginav><a class=prev href=https://unofficialism.info/posts/unofficial-tips-for-cka-and-ckad-exams/><span class=title>« Prev</span><br><span>Unofficial tips for CKA and CKAD exams</span>
</a><a class=next href=https://unofficialism.info/posts/envoy-proxy-demos/><span class=title>Next »</span><br><span>Set of Envoy Proxy features demos</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Easy way to SSH into Azure Kubernetes Service cluster node VMs on twitter" href="https://twitter.com/intent/tweet/?text=Easy%20way%20to%20SSH%20into%20Azure%20Kubernetes%20Service%20cluster%20node%20VMs&amp;url=https%3a%2f%2funofficialism.info%2fposts%2feasy-way-ssh-into-aks-cluster-node%2f&amp;hashtags=ssh%2cazure%2ckubernetes%2cazure-kubernetes-services%2ckubectl-plugin"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Easy way to SSH into Azure Kubernetes Service cluster node VMs on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2funofficialism.info%2fposts%2feasy-way-ssh-into-aks-cluster-node%2f&amp;title=Easy%20way%20to%20SSH%20into%20Azure%20Kubernetes%20Service%20cluster%20node%20VMs&amp;summary=Easy%20way%20to%20SSH%20into%20Azure%20Kubernetes%20Service%20cluster%20node%20VMs&amp;source=https%3a%2f%2funofficialism.info%2fposts%2feasy-way-ssh-into-aks-cluster-node%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Easy way to SSH into Azure Kubernetes Service cluster node VMs on reddit" href="https://reddit.com/submit?url=https%3a%2f%2funofficialism.info%2fposts%2feasy-way-ssh-into-aks-cluster-node%2f&title=Easy%20way%20to%20SSH%20into%20Azure%20Kubernetes%20Service%20cluster%20node%20VMs"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Easy way to SSH into Azure Kubernetes Service cluster node VMs on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2funofficialism.info%2fposts%2feasy-way-ssh-into-aks-cluster-node%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://unofficialism.info>Yoichi Kawasaki</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>