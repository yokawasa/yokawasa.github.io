<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Collecting logs into Azure DocumentDB using fluent-plugin-documentdb | Yoichi Kawasaki</title><meta name=keywords content="DocumentDB,fluentd,fluent-plugin-documentdb,Ruby"><meta name=description content="In this article, I&rsquo;d like to introduces a solution to collect logs and store them into Azure DocumentDB using fluentd and its plugin, fluent-plugin-documentdb.
Azure DocumentDB is a managed NoSQL database service provided by Microsoft Azure. It&rsquo;s schemaless, natively support JSON, very easy-to-use, very fast, highly reliable, and enables rapid deployment, you name it. Fluentd is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data."><meta name=author content="Yoichi Kawasaki"><link rel=canonical href=https://unofficialism.info/posts/collecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb/><link crossorigin=anonymous href=https://unofficialism.info/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=https://unofficialism.info/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://unofficialism.info/profile.jpg><link rel=icon type=image/png sizes=16x16 href=https://unofficialism.info/profile.jpg><link rel=icon type=image/png sizes=32x32 href=https://unofficialism.info/profile.jpg><link rel=apple-touch-icon href=https://unofficialism.info/profile.jpg><link rel=mask-icon href=https://unofficialism.info/profile.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Collecting logs into Azure DocumentDB using fluent-plugin-documentdb"><meta property="og:description" content="In this article, I&rsquo;d like to introduces a solution to collect logs and store them into Azure DocumentDB using fluentd and its plugin, fluent-plugin-documentdb.
Azure DocumentDB is a managed NoSQL database service provided by Microsoft Azure. It&rsquo;s schemaless, natively support JSON, very easy-to-use, very fast, highly reliable, and enables rapid deployment, you name it. Fluentd is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data."><meta property="og:type" content="article"><meta property="og:url" content="https://unofficialism.info/posts/collecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb/"><meta property="og:image" content="https://unofficialism.info/assets/20160221-fluentd-azure-documentdb.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-02-21T19:35:09+00:00"><meta property="article:modified_time" content="2016-02-21T19:35:09+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://unofficialism.info/assets/20160221-fluentd-azure-documentdb.jpg"><meta name=twitter:title content="Collecting logs into Azure DocumentDB using fluent-plugin-documentdb"><meta name=twitter:description content="In this article, I&rsquo;d like to introduces a solution to collect logs and store them into Azure DocumentDB using fluentd and its plugin, fluent-plugin-documentdb.
Azure DocumentDB is a managed NoSQL database service provided by Microsoft Azure. It&rsquo;s schemaless, natively support JSON, very easy-to-use, very fast, highly reliable, and enables rapid deployment, you name it. Fluentd is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://unofficialism.info/posts/"},{"@type":"ListItem","position":3,"name":"Collecting logs into Azure DocumentDB using fluent-plugin-documentdb","item":"https://unofficialism.info/posts/collecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Collecting logs into Azure DocumentDB using fluent-plugin-documentdb","name":"Collecting logs into Azure DocumentDB using fluent-plugin-documentdb","description":"In this article, I\u0026rsquo;d like to introduces a solution to collect logs and store them into Azure DocumentDB using fluentd and its plugin, fluent-plugin-documentdb.\nAzure DocumentDB is a managed NoSQL database service provided by Microsoft Azure. It\u0026rsquo;s schemaless, natively support JSON, very easy-to-use, very fast, highly reliable, and enables rapid deployment, you name it. Fluentd is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data.","keywords":["DocumentDB","fluentd","fluent-plugin-documentdb","Ruby"],"articleBody":"In this article, I’d like to introduces a solution to collect logs and store them into Azure DocumentDB using fluentd and its plugin, fluent-plugin-documentdb.\nAzure DocumentDB is a managed NoSQL database service provided by Microsoft Azure. It’s schemaless, natively support JSON, very easy-to-use, very fast, highly reliable, and enables rapid deployment, you name it. Fluentd is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data. fluent-plugin-documentdb is fluentd output plugin that enables to store event collections into Azure DocumentDB.\nThis article shows how to\nCollect Apache httpd logs across web servers Ship the collected logs into the aggregator Fluentd in near real-time Store the collected logs into DocumentDB Utilize the collected log data stored on Document DB for advanced scenarios - like archiving the data to Azure Storage, doing Big data analysis, visualizing the data with PowerBI, and so forth Pre-requisites A basic understanding of fluentd - if you’re not familiar with fluentd, fluentd quickstart guide is good starting point Azure subscription - you need to have Azure subscription that grants you access to Microsoft Azure services, and under which you can create DocumentDB cluster. If you don’t have yet click here to create it Setup: Azure DocumentDB To use Azure DocumentDB, you must create a DocumentDB database account using either the Azure portal, Azure Resource Manager templates, or Azure command-line interface (CLI). In addition, you must have a database and a collection to which fluent-plugin-documentdb writes event-stream out. Here are instructions:\nCreate a DocumentDB database account using the Azure portal, or Azure Resource Manager templates and Azure CLI How to create a database for DocumentDB Create a DocumentDB collection Setup: Fluentd Aggregator First of all, install Fluentd. The following shows how to install Fluentd using Ruby gem packger but if you are not using Ruby Gem for the installation, please refer to this installation guide where you can find many other ways to install Fluentd on many platforms.\n# install fluentd $ sudo gem install fluentd --no-ri --no-rdoc # create fluent.conf $ fluentd --setup Also, install fluent-plugin-documentdb for fluentd aggregator to store collected logs data into Azure DocumentDB.\n$ sudo gem install fluent-plugin-documentdb Next, configure fluent.conf, a fluentd configuration file as follows. Please see this for fluent-plugin-documentdb configuration.\n# Receive events from 24224/tcp # This is used by log forwarding and the fluent-cat command @type forward port 24224 # Store Data in DocumentDB ","wordCount":"913","inLanguage":"en","datePublished":"2016-02-21T19:35:09Z","dateModified":"2016-02-21T19:35:09Z","author":{"@type":"Person","name":"Yoichi Kawasaki"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://unofficialism.info/posts/collecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb/"},"publisher":{"@type":"Organization","name":"Yoichi Kawasaki","logo":{"@type":"ImageObject","url":"https://unofficialism.info/profile.jpg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://unofficialism.info accesskey=h title="Yoichi Kawasaki (Alt + H)">Yoichi Kawasaki</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://unofficialism.info/about title=about><span>about</span></a></li><li><a href=https://unofficialism.info/posts title=posts><span>posts</span></a></li><li><a href=https://unofficialism.info/works title=works><span>works</span></a></li><li><a href=https://unofficialism.info/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://unofficialism.info/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://unofficialism.info>Home</a>&nbsp;»&nbsp;<a href=https://unofficialism.info/posts/>Posts</a></div><h1 class=post-title>Collecting logs into Azure DocumentDB using fluent-plugin-documentdb</h1><div class=post-meta><span title='2016-02-21 00:00:00 +0000 UTC'>February 21, 2016</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Yoichi Kawasaki&nbsp;|&nbsp;<a href=https://github.com/yokawasa/yokawasa.github.io/tree/master/content/posts/2016-02-21-collecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pre-requisites aria-label=Pre-requisites>Pre-requisites</a></li><li><a href=#setup-azure-documentdb aria-label="Setup: Azure DocumentDB">Setup: Azure DocumentDB</a></li><li><a href=#setup-fluentd-aggregator aria-label="Setup: Fluentd Aggregator">Setup: Fluentd Aggregator</a></li><li><a href=#setup-fluentd-forwarders aria-label="Setup: Fluentd Forwarders">Setup: Fluentd Forwarders</a></li><li><a href=#test aria-label=TEST>TEST</a></li><li><a href=#more-log-collections-from-external-sources aria-label="More log collections from external sources">More log collections from external sources</a></li><li><a href=#setup-for-advanced-senarios aria-label="Setup for Advanced senarios">Setup for Advanced senarios</a></li></ul></div></details></div><div class=post-content><p>In this article, I&rsquo;d like to introduces a solution to collect logs and store them into Azure DocumentDB using fluentd and its plugin, fluent-plugin-documentdb.</p><p><a href=https://azure.microsoft.com/en-us/services/documentdb/>Azure DocumentDB</a> is a managed NoSQL database service provided by Microsoft Azure. It&rsquo;s schemaless, natively support JSON, very easy-to-use, very fast, highly reliable, and enables rapid deployment, you name it. <a href=http://www.fluentd.org/>Fluentd</a> is an open source data collector, which lets you unify the data collection and consumption for a better use and understanding of data. <a href=https://github.com/yokawasa/fluent-plugin-documentdb>fluent-plugin-documentdb</a> is fluentd output plugin that enables to store event collections into Azure DocumentDB.</p><p>This article shows how to</p><ul><li>Collect Apache httpd logs across web servers</li><li>Ship the collected logs into the aggregator Fluentd in near real-time</li><li>Store the collected logs into DocumentDB</li><li>Utilize the collected log data stored on Document DB for advanced scenarios - like archiving the data to Azure Storage, doing Big data analysis, visualizing the data with PowerBI, and so forth</li></ul><p><img loading=lazy src=https://unofficialism.info/assets/20160221-fluentd-azure-documentdb.jpg alt=fluentd-azure-documentdb></p><h2 id=pre-requisites>Pre-requisites<a hidden class=anchor aria-hidden=true href=#pre-requisites>#</a></h2><ul><li>A basic understanding of fluentd - if you&rsquo;re not familiar with fluentd, <a href=http://docs.fluentd.org/articles/quickstart>fluentd quickstart guide</a> is good starting point</li><li>Azure subscription - you need to have Azure subscription that grants you access to Microsoft Azure services, and under which you can create DocumentDB cluster. If you don&rsquo;t have yet click <a href=https://account.windowsazure.com/Subscriptions>here</a> to create it</li></ul><h2 id=setup-azure-documentdb>Setup: Azure DocumentDB<a hidden class=anchor aria-hidden=true href=#setup-azure-documentdb>#</a></h2><p>To use Azure DocumentDB, you must create a DocumentDB database account using either the Azure portal, Azure Resource Manager templates, or Azure command-line interface (CLI). In addition, you must have a database and a collection to which fluent-plugin-documentdb writes event-stream out. Here are instructions:</p><ul><li>Create a DocumentDB database account using <a href=https://azure.microsoft.com/en-us/documentation/articles/documentdb-create-account/>the Azure portal</a>, or <a href=https://azure.microsoft.com/en-us/documentation/articles/documentdb-automation-resource-manager-cli/>Azure Resource Manager templates and Azure CLI</a></li><li><a href=https://azure.microsoft.com/en-us/documentation/articles/documentdb-create-database/>How to create a database for DocumentDB</a></li><li><a href=https://azure.microsoft.com/en-us/documentation/articles/documentdb-create-collection/>Create a DocumentDB collection</a></li></ul><h2 id=setup-fluentd-aggregator>Setup: Fluentd Aggregator<a hidden class=anchor aria-hidden=true href=#setup-fluentd-aggregator>#</a></h2><p>First of all, install Fluentd. The following shows how to install Fluentd using Ruby gem packger but if you are not using Ruby Gem for the installation, please refer to <a href=http://docs.fluentd.org/categories/installation>this installation guide</a> where you can find many other ways to install Fluentd on many platforms.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># install fluentd</span>
</span></span><span style=display:flex><span>$ sudo gem install fluentd --no-ri --no-rdoc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create fluent.conf</span>
</span></span><span style=display:flex><span>$ fluentd --setup 
</span></span></code></pre></div><p>Also, install <a href=https://github.com/yokawasa/fluent-plugin-documentdb>fluent-plugin-documentdb</a> for fluentd aggregator to store collected logs data into Azure DocumentDB.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo gem install fluent-plugin-documentdb
</span></span></code></pre></div><p>Next, configure fluent.conf, a fluentd configuration file as follows. Please see <a href=https://github.com/yokawasa/fluent-plugin-documentdb>this</a> for fluent-plugin-documentdb configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span># Receive events from 24224/tcp
</span></span><span style=display:flex><span># This is used by log forwarding and the fluent-cat command
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;source&gt;</span>
</span></span><span style=display:flex><span>    @type forward
</span></span><span style=display:flex><span>    port 24224
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/source&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Store Data in DocumentDB
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;match</span> <span style=color:#960050;background-color:#1e0010>apache.access</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    @type documentdb
</span></span><span style=display:flex><span>    docdb_endpoint https://yoichikademo.documents.azure.com:443/
</span></span><span style=display:flex><span>    docdb_account_key Tl1+ikQtnExxxUisJ+BXwbbaC8NtUqYVE9kUDXCNust5aYBduhui29Xtxz3DLP88PayjtgtnARc1PW+2wlA6jCJw==  (dummy)
</span></span><span style=display:flex><span>    docdb_database LogDB
</span></span><span style=display:flex><span>    docdb_collection Collection1
</span></span><span style=display:flex><span>    auto_create_database true
</span></span><span style=display:flex><span>    auto_create_collection true
</span></span><span style=display:flex><span>    time_format %Y%m%d-%H:%M:%S
</span></span><span style=display:flex><span>    localtime true
</span></span><span style=display:flex><span>    add_time_field true
</span></span><span style=display:flex><span>    time_field_name time
</span></span><span style=display:flex><span>    add_tag_field true
</span></span><span style=display:flex><span>    tag_field_name tag
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/match&gt;</span>
</span></span></code></pre></div><p>Regarding he port number of the aggregator host above, the default is 24224. Note that both TCP packets (event stream) and UDP packets (heartbeat message) are sent to this port, which mean you need to open both TCP and UDP for this port if you have access controls between forwarders and aggregator. Please see the <a href=http://docs.fluentd.org/articles/out_forward>forward Output plugin article</a> to understand more about forward plugin.</p><p>Finally, run fluentd with specifiying fluent.conf that you configurea above.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ fluentd -c ./fluent.conf -vv &amp;
</span></span></code></pre></div><h2 id=setup-fluentd-forwarders>Setup: Fluentd Forwarders<a hidden class=anchor aria-hidden=true href=#setup-fluentd-forwarders>#</a></h2><p>First, to set up Fluentd, run the following command to setup Fluentd. Again If you are not using Ruby Gem for the installation, please refer to the <a href=http://docs.fluentd.org/v0.12/categories/installation>installation document</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># install fluentd</span>
</span></span><span style=display:flex><span>$ sudo gem install fluentd --no-ri --no-rdoc<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create fluent.conf</span>
</span></span><span style=display:flex><span>$ fluentd --setup 
</span></span></code></pre></div><p>Then, give Fluentd a read access to servers&rsquo;log files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo chmod og+rx /var/log/apache2
</span></span><span style=display:flex><span>$ sudo chmod og+r /var/log/apache2/*
</span></span></code></pre></div><p>Next, configure fluent.conf, a fluentd configuration file as follows to tail apache access logs and forard event to aggregator</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span># Apache Access Logs
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;source&gt;</span>
</span></span><span style=display:flex><span>    @type tail
</span></span><span style=display:flex><span>    path /var/log/apache2/access.log   # monitoring file
</span></span><span style=display:flex><span>    pos_file /tmp/fluentd_pos_file     # position file
</span></span><span style=display:flex><span>    format apache                      # format
</span></span><span style=display:flex><span>    tag apache.access                  # tag
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/source&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Forward data to the aggregator
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;match</span> <span style=color:#960050;background-color:#1e0010>apache.access</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    @type forward
</span></span><span style=display:flex><span>    buffer_type memory
</span></span><span style=display:flex><span>    buffer_chunk_limit 8m
</span></span><span style=display:flex><span>    buffer_queue_limit 64
</span></span><span style=display:flex><span>    flush_interval 1s
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;server&gt;</span>
</span></span><span style=display:flex><span>        host  <span style=color:#f92672>&lt;Aggregator</span><span style=color:#960050;background-color:#1e0010>&#39;s</span> <span style=color:#960050;background-color:#1e0010>hostname</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>IP</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        port 24224
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/server&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;secondary&gt;</span>
</span></span><span style=display:flex><span>        @type file
</span></span><span style=display:flex><span>        path /var/log/fluentd/forward-failed
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/secondary&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/match&gt;</span>
</span></span></code></pre></div><p>Finally, start Fluentd with the configuration above to start log collections</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ fluentd -c ./fluent.conf -vv &amp;
</span></span></code></pre></div><h2 id=test>TEST<a hidden class=anchor aria-hidden=true href=#test>#</a></h2><p>Let&rsquo;s check if logs will be forwarded from apache nodes to aggegator and ultimately stored in documentdb. First, create log events by sending test requests to web servers somehow (here using apache bench for example)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ab -n <span style=color:#ae81ff>5</span> -c <span style=color:#ae81ff>2</span> http://&lt;targetserver&gt;/foo/bar/test.html
</span></span></code></pre></div><p>If logs are collected successfully, you can see the logs stored in DocumentDB easily by using Document DB&rsquo;s query explorer. Go to Azure Portal > Display your DocumentDB dashboard > Query Explorer.</p><p><img loading=lazy src=https://unofficialism.info/assets/20160221-DocumentDB-QueryExplorer.jpg alt=DocumentDB-QueryExplorer></p><h2 id=more-log-collections-from-external-sources>More log collections from external sources<a hidden class=anchor aria-hidden=true href=#more-log-collections-from-external-sources>#</a></h2><p>Fluentd&rsquo;s Input plugins extend Fluentd to retrieve and pull event logs from external sources. An input plugin typically creates a thread socket and a listen socket. It can also periodically pull data from data sources. For examples, listening syslog events, tailing apache/nginx logs, and pulling data from well-known RDBMS/NoSQLs on-premices or on public cloud. See <a href=http://www.fluentd.org/plugins>http://www.fluentd.org/plugins</a></p><h2 id=setup-for-advanced-senarios>Setup for Advanced senarios<a hidden class=anchor aria-hidden=true href=#setup-for-advanced-senarios>#</a></h2><ul><li>Using Secure-forward instead of simple forward plugin in order to have communication over SSL between forward servers and aggregator: <a href=https://github.com/tagomoris/fluent-plugin-secure-forward>https://github.com/tagomoris/fluent-plugin-secure-forward</a></li><li>Configuring DocumentDB&rsquo;s <a href=http://hadoop.apache.org/>Hadoop</a> connector that allows DocumentDB to act as both a source and sink for <a href=http://hive.apache.org/>Hive</a>, <a href=http://pig.apache.org/>Pig</a> and MapReduce jobs: <a href=https://azure.microsoft.com/en-us/documentation/articles/documentdb-run-hadoop-with-hdinsight/>https://azure.microsoft.com/en-us/documentation/articles/documentdb-run-hadoop-with-hdinsight/</a></li><li>Setup Azure Data factory to from DocumentDB to Azure Blob Storage for Archiving the data: <a href=https://azure.microsoft.com/en-us/documentation/articles/data-factory-azure-documentdb-connector/>https://azure.microsoft.com/en-us/documentation/articles/data-factory-azure-documentdb-connector/</a></li><li>Configuring DocumentDB&rsquo;s PowerBI connector that allows DocumentDB to act as a source for PowerBI to create insightful visualizations for DocumentDB data: <a href=https://azure.microsoft.com/en-us/blog/unleashing-insights-from-data-in-documentdb-with-power-bi/>https://azure.microsoft.com/en-us/blog/unleashing-insights-from-data-in-documentdb-with-power-bi/</a></li></ul><p>Happy log collections with Azure DocumentDB and fluentd!!</p><p>END</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://unofficialism.info/tags/documentdb/>DocumentDB</a></li><li><a href=https://unofficialism.info/tags/fluentd/>fluentd</a></li><li><a href=https://unofficialism.info/tags/fluent-plugin-documentdb/>fluent-plugin-documentdb</a></li><li><a href=https://unofficialism.info/tags/ruby/>Ruby</a></li></ul><nav class=paginav><a class=prev href=https://unofficialism.info/posts/fluent-plugin-documentdb-supports-partitioned-collections/><span class=title>« Prev Page</span><br><span>fluent-plugin-documentdb supports Partitioned collections</span></a>
<a class=next href=https://unofficialism.info/posts/fluentd-plugins-for-microsoft-azure-services/><span class=title>Next Page »</span><br><span>fluentd plugins for Microsoft Azure Services</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Collecting logs into Azure DocumentDB using fluent-plugin-documentdb on twitter" href="https://twitter.com/intent/tweet/?text=Collecting%20logs%20into%20Azure%20DocumentDB%20using%20fluent-plugin-documentdb&url=https%3a%2f%2funofficialism.info%2fposts%2fcollecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb%2f&hashtags=DocumentDB%2cfluentd%2cfluent-plugin-documentdb%2cRuby"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Collecting logs into Azure DocumentDB using fluent-plugin-documentdb on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2funofficialism.info%2fposts%2fcollecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb%2f&title=Collecting%20logs%20into%20Azure%20DocumentDB%20using%20fluent-plugin-documentdb&summary=Collecting%20logs%20into%20Azure%20DocumentDB%20using%20fluent-plugin-documentdb&source=https%3a%2f%2funofficialism.info%2fposts%2fcollecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Collecting logs into Azure DocumentDB using fluent-plugin-documentdb on reddit" href="https://reddit.com/submit?url=https%3a%2f%2funofficialism.info%2fposts%2fcollecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb%2f&title=Collecting%20logs%20into%20Azure%20DocumentDB%20using%20fluent-plugin-documentdb"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Collecting logs into Azure DocumentDB using fluent-plugin-documentdb on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2funofficialism.info%2fposts%2fcollecting-logs-into-azure-documentdb-using-fluent-plugin-documentdb%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://unofficialism.info>Yoichi Kawasaki</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>