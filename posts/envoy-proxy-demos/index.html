<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Set of Envoy Proxy features demos | Yoichi Kawasaki</title><meta name=keywords content="envoy,envoyproxy,servicemesh,istio,docker-compose"><meta name=description content="Set of demos to demonstrate Envoy Proxy features
HTTP Routing: Simple Match Routing All traffic is routed by the front envoy to the service containers. Internally the traffic is routed to the service envoys, then the service envoys route the request to the flask app via the loopback address. In this demo, all traffic is routed to the service envoys like this:
A request (path /service/blue & port 8000) is routed to service_blue A request (path /service/green & port 8000) is routed to service_green A request (path /service/red & port 8000) is routed to service_red Key definition 1 - virtual_hosts in front-envoy."><meta name=author content="Yoichi Kawasaki"><link rel=canonical href=https://unofficialism.info/posts/envoy-proxy-demos/><link crossorigin=anonymous href=https://unofficialism.info/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=https://unofficialism.info/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://unofficialism.info/Thinking_Face_Emoji_large.png><link rel=icon type=image/png sizes=16x16 href=https://unofficialism.info/Thinking_Face_Emoji_large.png><link rel=icon type=image/png sizes=32x32 href=https://unofficialism.info/Thinking_Face_Emoji_large.png><link rel=apple-touch-icon href=https://unofficialism.info/Thinking_Face_Emoji_large.png><link rel=mask-icon href=https://unofficialism.info/Thinking_Face_Emoji_large.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Set of Envoy Proxy features demos"><meta property="og:description" content="Set of demos to demonstrate Envoy Proxy features
HTTP Routing: Simple Match Routing All traffic is routed by the front envoy to the service containers. Internally the traffic is routed to the service envoys, then the service envoys route the request to the flask app via the loopback address. In this demo, all traffic is routed to the service envoys like this:
A request (path /service/blue & port 8000) is routed to service_blue A request (path /service/green & port 8000) is routed to service_green A request (path /service/red & port 8000) is routed to service_red Key definition 1 - virtual_hosts in front-envoy."><meta property="og:type" content="article"><meta property="og:url" content="https://unofficialism.info/posts/envoy-proxy-demos/"><meta property="og:image" content="https://unofficialism.info/profile.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-01-14T19:32:40+00:00"><meta property="article:modified_time" content="2019-01-14T19:32:40+00:00"><meta property="og:site_name" content="Yoichi Kawasaki"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://unofficialism.info/profile.jpg"><meta name=twitter:title content="Set of Envoy Proxy features demos"><meta name=twitter:description content="Set of demos to demonstrate Envoy Proxy features
HTTP Routing: Simple Match Routing All traffic is routed by the front envoy to the service containers. Internally the traffic is routed to the service envoys, then the service envoys route the request to the flask app via the loopback address. In this demo, all traffic is routed to the service envoys like this:
A request (path /service/blue & port 8000) is routed to service_blue A request (path /service/green & port 8000) is routed to service_green A request (path /service/red & port 8000) is routed to service_red Key definition 1 - virtual_hosts in front-envoy."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://unofficialism.info/posts/"},{"@type":"ListItem","position":3,"name":"Set of Envoy Proxy features demos","item":"https://unofficialism.info/posts/envoy-proxy-demos/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Set of Envoy Proxy features demos","name":"Set of Envoy Proxy features demos","description":"Set of demos to demonstrate Envoy Proxy features\nHTTP Routing: Simple Match Routing All traffic is routed by the front envoy to the service containers. Internally the traffic is routed to the service envoys, then the service envoys route the request to the flask app via the loopback address. In this demo, all traffic is routed to the service envoys like this:\nA request (path /service/blue \u0026amp; port 8000) is routed to service_blue A request (path /service/green \u0026amp; port 8000) is routed to service_green A request (path /service/red \u0026amp; port 8000) is routed to service_red Key definition 1 - virtual_hosts in front-envoy.","keywords":["envoy","envoyproxy","servicemesh","istio","docker-compose"],"articleBody":"Set of demos to demonstrate Envoy Proxy features\nHTTP Routing: Simple Match Routing All traffic is routed by the front envoy to the service containers. Internally the traffic is routed to the service envoys, then the service envoys route the request to the flask app via the loopback address. In this demo, all traffic is routed to the service envoys like this:\nA request (path /service/blue \u0026 port 8000) is routed to service_blue A request (path /service/green \u0026 port 8000) is routed to service_green A request (path /service/red \u0026 port 8000) is routed to service_red Key definition 1 - virtual_hosts in front-envoy.yaml\nvirtual_hosts: - name: backend domains: - \"*\" routes: - match: prefix: \"/service/blue\" route: cluster: service_green - match: prefix: \"/service/blue\" route: cluster: service_blue - match: prefix: \"/service/red\" route: cluster: service_red Key definition 2 - clusters in front-envoy.yaml\nclusters: - name: service_blue connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_blue port_value: 80 - name: service_green connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_green port_value: 80 - name: service_red connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_red port_value: 80 To continue, go to github\nHTTP Routing: Routing based on Header Condition Key definition 1 - virtual_hosts in front-envoy.yaml\nvirtual_hosts: - name: backend domains: - \"*\" routes: - match: prefix: \"/service/blue\" headers: - name: \"x-canary-version\" exact_match: \"service_green\" route: cluster: service_green - match: prefix: \"/service/blue\" route: cluster: service_blue - match: prefix: \"/service/red\" route: cluster: service_red Key definition 2 - clusters in front-envoy.yaml\nclusters: - name: service_blue connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_blue port_value: 80 - name: service_green connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_green port_value: 80 - name: service_red connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_red port_value: 80 To continue, go to github\nHTTP Routing: Blue Green Traffic Splitting Key definition 1 - virtual_hosts in front-envoy.yaml\nvirtual_hosts: - name: backend domains: - \"*\" routes: - match: prefix: \"/service/blue\" route: weighted_clusters: clusters: - name: service_green weight: 10 - name: service_blue weight: 90 - match: prefix: \"/service/red\" route: cluster: service_red Key definition 2 - clusters in front-envoy.yaml\nclusters: - name: service_blue connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_blue port_value: 80 - name: service_green connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_green port_value: 80 - name: service_red connect_timeout: 0.25s type: strict_dns lb_policy: round_robin http2_protocol_options: {} hosts: - socket_address: address: service_red port_value: 80 To continue, go to github\nFault Injection Fault injection is a technique for improving the coverage of a test by introducing faults to test code paths, in particular error handling code paths, that might otherwise rarely be followed. The filter ( http_filters in the demo ) can be used to inject delays and abort requests with user-specified error codes.\nFront-proxy configurations are the same as the ones in HTTP Routing: Simple Match Routing. Differences from HTTP Routing: Simple Match Routing are the following 2 fault injections:\nFault injection abort (50% of requests will be aborted with 503 error code) for the requests to service_red Fault injection delay (50% of requests will be 10 seconds delayed) for the requests to service_blue Key definition 1 - http_filters in service-envoy-fault-injection-abort.yaml\nhttp_filters: - name: envoy.fault config: abort: http_status: 503 percentage: numerator: 50 denominator: HUNDRED For numerator and denominator of percentage, see type.FractionalPercent\nKey definition 2 - http_filters in service-envoy-fault-injection-delay.yaml\nhttp_filters: - name: envoy.fault config: delay: type: fixed fixed_delay: 10s percentage: numerator: 50 denominator: HUNDRED For fixed_delay and percentage of delay injection, see config.filter.fault.v2.FaultDelay\nTo continue, go to github\nCircuit Breaker Circuit Breaking lets you configure failure thresholds that ensure safe maximums after which these requests stop. This allows for a more graceful failure, and time to respond to potential issues before they become larger.\nCircuit Breaker is configured in service_red such that Circuit Breaker will be triggered with the following conditions: Envoy makes more than max connection#:1 Envoy makes more than max parallel requests#:1 Key definition - clusters in service-envoy-circuitbreaker.yaml\nclusters: - name: local_service connect_timeout: 0.25s type: strict_dns lb_policy: round_robin circuit_breakers: thresholds: max_connections: 1 max_pending_requests: 1 max_requests: 1 hosts: - socket_address: address: 127.0.0.1 port_value: 8080 For the detail of circuit_breakers configuration, see cluster.CircuitBreakers\nTo continue, go to github\nTimeouts and Retries Front-proxy configurations are the same as the ones in HTTP Routing: Simple Match Routing. Differences from HTTP Routing: Simple Match Routing are the following 2 additional behaviors:\nTimeouts (5 seconds) for the request to service_blue Retries that Envoy will attempt to do if service_red responds with any 5xx response code For Service Containers, delay fault injection and abort fault injection are configured in service_blue and service_red respectively (which are the same configuration as the ones in Fault Injection Demo)\nKey definition - virtual_hosts in front-envoy.yaml\nvirtual_hosts: - name: backend domains: - \"*\" routes: - match: prefix: \"/service/blue\" route: cluster: service_blue timeout: 5s - match: prefix: \"/service/green\" route: cluster: service_green - match: prefix: \"/service/red\" route: cluster: service_red retry_policy: retry_on: \"5xx\" num_retries: 3 per_try_timeout: 5s timeout: (Duration) Specifies the timeout for the route. If not specified, the default is 15s. For more detail, see timeout section in RouteAction retry_policy indicates the retry policy for all routes in this virtual host. For more detail on retry_policy, see route.RetryPolicy To continue, go to github\n","wordCount":"888","inLanguage":"en","datePublished":"2019-01-14T19:32:40Z","dateModified":"2019-01-14T19:32:40Z","author":{"@type":"Person","name":"Yoichi Kawasaki"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://unofficialism.info/posts/envoy-proxy-demos/"},"publisher":{"@type":"Organization","name":"Yoichi Kawasaki","logo":{"@type":"ImageObject","url":"https://unofficialism.info/Thinking_Face_Emoji_large.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://unofficialism.info accesskey=h title="unofficialism (Alt + H)">unofficialism</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://unofficialism.info/about title=about><span>about</span></a></li><li><a href=https://unofficialism.info/posts title=posts><span>posts</span></a></li><li><a href=https://unofficialism.info/works title=works><span>works</span></a></li><li><a href=https://unofficialism.info/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://unofficialism.info/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://unofficialism.info>Home</a>&nbsp;»&nbsp;<a href=https://unofficialism.info/posts/>Posts</a></div><h1 class=post-title>Set of Envoy Proxy features demos</h1><div class=post-meta><span title='2019-01-14 00:00:00 +0000 UTC'>January 14, 2019</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Yoichi Kawasaki&nbsp;|&nbsp;<a href=https://github.com/yokawasa/yokawasa.github.io/tree/master/content/posts/2019-01-14-envoy-proxy-demos.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#http-routing-simple-match-routing aria-label="HTTP Routing: Simple Match Routing">HTTP Routing: Simple Match Routing</a></li><li><a href=#http-routing-routing-based-on-header-condition aria-label="HTTP Routing: Routing based on Header Condition">HTTP Routing: Routing based on Header Condition</a></li><li><a href=#http-routing-blue-green-traffic-splitting aria-label="HTTP Routing: Blue Green Traffic Splitting">HTTP Routing: Blue Green Traffic Splitting</a></li><li><a href=#fault-injection aria-label="Fault Injection">Fault Injection</a></li><li><a href=#circuit-breaker aria-label="Circuit Breaker">Circuit Breaker</a></li><li><a href=#timeouts-and-retries aria-label="Timeouts and Retries">Timeouts and Retries</a></li></ul></div></details></div><div class=post-content><p>Set of demos to demonstrate Envoy Proxy features</p><h2 id=http-routing-simple-match-routing>HTTP Routing: Simple Match Routing<a hidden class=anchor aria-hidden=true href=#http-routing-simple-match-routing>#</a></h2><p>All traffic is routed by the <code>front envoy</code> to the <code>service containers</code>. Internally the traffic is routed to the service envoys, then the service envoys route the request to the flask app via the loopback address. In this demo, all traffic is routed to the service envoys like this:</p><ul><li>A request (path <code>/service/blue</code> & port <code>8000</code>) is routed to <code>service_blue</code></li><li>A request (path <code>/service/green</code> & port <code>8000</code>) is routed to <code>service_green</code></li><li>A request (path <code>/service/red</code> & port <code>8000</code>) is routed to <code>service_red</code></li></ul><p><img loading=lazy src=https://raw.githubusercontent.com/yokawasa/envoy-proxy-demos/master/assets/demo-httproute-simple-match.png alt></p><p>Key definition 1 - <code>virtual_hosts</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/httproute-simple-match/front-envoy.yaml>front-envoy.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>virtual_hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>backend</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>domains</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/blue&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/blue&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/red&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_red</span>
</span></span></code></pre></div><p>Key definition 2 - <code>clusters</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/httproute-simple-match/front-envoy.yaml>front-envoy.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>clusters</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_red</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_red</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><p>To continue, go to <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/httproute-simple-match>github</a></p><h2 id=http-routing-routing-based-on-header-condition>HTTP Routing: Routing based on Header Condition<a hidden class=anchor aria-hidden=true href=#http-routing-routing-based-on-header-condition>#</a></h2><p><img loading=lazy src=https://raw.githubusercontent.com/yokawasa/envoy-proxy-demos/master/assets/demo-httproute-header-match.png alt></p><p>Key definition 1 - <code>virtual_hosts</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/httproute-header-match/front-envoy.yaml>front-envoy.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>virtual_hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>backend</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>domains</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/blue&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;x-canary-version&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>exact_match</span>: <span style=color:#e6db74>&#34;service_green&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/blue&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/red&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_red</span>
</span></span></code></pre></div><p>Key definition 2 - <code>clusters</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/httproute-header-match/front-envoy.yaml>front-envoy.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>clusters</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_red</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_red</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><p>To continue, go to <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/httproute-header-match>github</a></p><h2 id=http-routing-blue-green-traffic-splitting>HTTP Routing: Blue Green Traffic Splitting<a hidden class=anchor aria-hidden=true href=#http-routing-blue-green-traffic-splitting>#</a></h2><p><img loading=lazy src=https://raw.githubusercontent.com/yokawasa/envoy-proxy-demos/master/assets/demo-httproute-blue-green.png alt></p><p>Key definition 1 - <code>virtual_hosts</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/httproute-blue-green/front-envoy.yaml>front-envoy.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>virtual_hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>backend</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>domains</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/blue&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>weighted_clusters</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>clusters</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>90</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/red&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_red</span>
</span></span></code></pre></div><p>Key definition 2 - <code>clusters</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/httproute-blue-green/front-envoy.yaml>front-envoy.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>clusters</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service_red</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http2_protocol_options</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>service_red</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><p>To continue, go to <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/httproute-blue-green>github</a></p><h2 id=fault-injection>Fault Injection<a hidden class=anchor aria-hidden=true href=#fault-injection>#</a></h2><p><a href=https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/fault_filter>Fault injection</a> is a technique for improving the coverage of a test by introducing faults to test code paths, in particular error handling code paths, that might otherwise rarely be followed. The <code>filter</code> ( <a href=https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/http_filters>http_filters</a> in the demo ) can be used to inject <code>delays</code> and <code>abort</code> requests with user-specified error codes.</p><p><img loading=lazy src=https://raw.githubusercontent.com/yokawasa/envoy-proxy-demos/master/assets/demo-fault-injection.png alt></p><p>Front-proxy configurations are the same as the ones in <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/httproute-simple-match>HTTP Routing: Simple Match Routing</a>. Differences from <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/httproute-simple-match>HTTP Routing: Simple Match Routing</a> are the following 2 fault injections:</p><ul><li>Fault injection <code>abort</code> (50% of requests will be aborted with 503 error code) for the requests to <code>service_red</code></li><li>Fault injection <code>delay</code> (50% of requests will be 10 seconds delayed) for the requests to <code>service_blue</code></li></ul><p>Key definition 1 - <code>http_filters</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/fault-injection/service-envoy-fault-injection-abort.yaml>service-envoy-fault-injection-abort.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>http_filters</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>envoy.fault</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>abort</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>http_status</span>: <span style=color:#ae81ff>503</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>percentage</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>numerator</span>: <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>denominator</span>: <span style=color:#ae81ff>HUNDRED</span>
</span></span></code></pre></div><blockquote><p>For <code>numerator</code> and <code>denominator</code> of <code>percentage</code>, see <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v2/type/percent.proto#envoy-api-msg-type-fractionalpercent>type.FractionalPercent</a></p></blockquote><p>Key definition 2 - <code>http_filters</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/fault-injection/service-envoy-fault-injection-delay.yaml>service-envoy-fault-injection-delay.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>http_filters</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>envoy.fault</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>delay</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>fixed</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>fixed_delay</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>percentage</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>numerator</span>: <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>denominator</span>: <span style=color:#ae81ff>HUNDRED</span>
</span></span></code></pre></div><blockquote><p>For <code>fixed_delay</code> and <code>percentage</code> of delay injection, see <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/filter/fault/v2/fault.proto#envoy-api-msg-config-filter-fault-v2-faultdelay>config.filter.fault.v2.FaultDelay</a></p></blockquote><p>To continue, go to <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/fault-injection>github</a></p><h2 id=circuit-breaker>Circuit Breaker<a hidden class=anchor aria-hidden=true href=#circuit-breaker>#</a></h2><p><a href=https://www.envoyproxy.io/learn/circuit-breaking>Circuit Breaking</a> lets you configure failure thresholds that ensure safe maximums after which these requests stop. This allows for a more graceful failure, and time to respond to potential issues before they become larger.</p><p><img loading=lazy src=https://raw.githubusercontent.com/yokawasa/envoy-proxy-demos/master/assets/demo-circuit-breaker.png alt></p><ul><li>Circuit Breaker is configured in <code>service_red</code> such that Circuit Breaker will be triggered with the following conditions:<ul><li>Envoy makes more than <code>max connection#:1</code></li><li>Envoy makes more than <code>max parallel requests#:1</code></li></ul></li></ul><p>Key definition - <code>clusters</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/circuit-breaker/service-envoy-circuitbreaker.yaml>service-envoy-circuitbreaker.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>clusters</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>local_service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connect_timeout</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>25s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strict_dns</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb_policy</span>: <span style=color:#ae81ff>round_robin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>circuit_breakers</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>thresholds</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>max_connections</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>max_pending_requests</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>max_requests</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>socket_address</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>address</span>: <span style=color:#ae81ff>127.0.0.1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port_value</span>: <span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><blockquote><p>For the detail of <code>circuit_breakers</code> configuration, see <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/circuit_breaker.proto#envoy-api-msg-cluster-circuitbreakers>cluster.CircuitBreakers</a></p></blockquote><p>To continue, go to <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/circuit-breaker>github</a></p><h2 id=timeouts-and-retries>Timeouts and Retries<a hidden class=anchor aria-hidden=true href=#timeouts-and-retries>#</a></h2><p><img loading=lazy src=https://raw.githubusercontent.com/yokawasa/envoy-proxy-demos/master/assets/demo-timeouts-retries.png alt></p><p>Front-proxy configurations are the same as the ones in <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/httproute-simple-match>HTTP Routing: Simple Match Routing</a>. Differences from <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/httproute-simple-match>HTTP Routing: Simple Match Routing</a> are the following 2 additional behaviors:</p><ul><li><code>Timeouts</code> (5 seconds) for the request to <code>service_blue</code></li><li><code>Retries</code> that Envoy will attempt to do if <code>service_red</code> responds with any 5xx response code</li></ul><p>For Service Containers, <code>delay</code> fault injection and <code>abort</code> fault injection are configured in <code>service_blue</code> and <code>service_red</code> respectively (which are the same configuration as the ones in <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/fault-injection>Fault Injection Demo</a>)</p><p>Key definition - <code>virtual_hosts</code> in <a href=https://github.com/yokawasa/envoy-proxy-demos/blob/master/timeouts-retries/front-envoy.yaml>front-envoy.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>virtual_hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>backend</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>domains</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/blue&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_blue</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/green&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_green</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>prefix</span>: <span style=color:#e6db74>&#34;/service/red&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>service_red</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>retry_policy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>retry_on</span>: <span style=color:#e6db74>&#34;5xx&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>num_retries</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>per_try_timeout</span>: <span style=color:#ae81ff>5s</span>
</span></span></code></pre></div><blockquote><ul><li><code>timeout</code>: (Duration) Specifies the timeout for the route. If not specified, the default is 15s. For more detail, see <code>timeout</code> section in <a href=https://www.envoyproxy.io/docs/envoy/v1.5.0/api-v2/rds.proto#routeaction>RouteAction</a></li><li><code>retry_policy</code> indicates the retry policy for all routes in this virtual host. For more detail on retry_policy, see <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto.html#envoy-api-msg-route-retrypolicy>route.RetryPolicy</a></li></ul></blockquote><p>To continue, go to <a href=https://github.com/yokawasa/envoy-proxy-demos/tree/master/timeouts-retries>github</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://unofficialism.info/tags/envoy/>envoy</a></li><li><a href=https://unofficialism.info/tags/envoyproxy/>envoyproxy</a></li><li><a href=https://unofficialism.info/tags/servicemesh/>servicemesh</a></li><li><a href=https://unofficialism.info/tags/istio/>Istio</a></li><li><a href=https://unofficialism.info/tags/docker-compose/>docker-compose</a></li></ul><nav class=paginav><a class=prev href=https://unofficialism.info/posts/easy-way-ssh-into-aks-cluster-node/><span class=title>« Prev Page</span><br><span>Easy way to SSH into Azure Kubernetes Service cluster node VMs</span></a>
<a class=next href=https://unofficialism.info/posts/quick-start-with-azure-function-v2-python-preview/><span class=title>Next Page »</span><br><span>Quick Start with Azure Functions V2 Python (Preview)</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Set of Envoy Proxy features demos on twitter" href="https://twitter.com/intent/tweet/?text=Set%20of%20Envoy%20Proxy%20features%20demos&url=https%3a%2f%2funofficialism.info%2fposts%2fenvoy-proxy-demos%2f&hashtags=envoy%2cenvoyproxy%2cservicemesh%2cistio%2cdocker-compose"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set of Envoy Proxy features demos on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2funofficialism.info%2fposts%2fenvoy-proxy-demos%2f&title=Set%20of%20Envoy%20Proxy%20features%20demos&summary=Set%20of%20Envoy%20Proxy%20features%20demos&source=https%3a%2f%2funofficialism.info%2fposts%2fenvoy-proxy-demos%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set of Envoy Proxy features demos on reddit" href="https://reddit.com/submit?url=https%3a%2f%2funofficialism.info%2fposts%2fenvoy-proxy-demos%2f&title=Set%20of%20Envoy%20Proxy%20features%20demos"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set of Envoy Proxy features demos on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2funofficialism.info%2fposts%2fenvoy-proxy-demos%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://unofficialism.info>Yoichi Kawasaki</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>